# This file contains the preferences for versions and variants.
# Note that spack can deviate from these preferences for various reasons:
# - if explicitly requested in spack.yaml
# - if required to satisfy explicit requests
# - if reuse == true and build caches contain other versions/variants
#   (this is disabled by concretize:reuse:false in concretizer.yaml)
#
# The variants in packages:all:variants are overridden by package-specific 
# variants. Therefore, we use the pattern require:any_of:[+variant,@:]
# which sets the variant or doesn't do anything if not supported.
#
packages:
  all:
    # duplication between the prefer and require sections is intentional
    # since 'require' for 'all' is overwritten by package-specific entries,
    # and 'prefer' at least retains some (less strict) preference in that case
    prefer:
    - '%gcc'
    # FIXME any ipo preference breaks llvm external reuse
    #- +ipo
    - build_system=cmake
    - build_type=Release
    require:
    - '%gcc'
    # FIXME any ipo requirement breaks llvm external reuse
    #- any_of: [+ipo, '@:']
    - any_of: [build_system=cmake, '@:']
    - any_of: [build_type=Release, '@:']
  acts:
    require:
    - '@44.4.0'
    - cxxstd=20 +dd4hep +edm4hep +examples +fatras +geant4 +json +onnx +podio +python +svg +tgeo +pr4496 +pr4502 +pr4620
    # ACTS requires same compiler as DD4hep since compiler options are reused
    - spec: '%gcc'
      when: '^dd4hep%gcc'
    - spec: '%clang'
      when: '^dd4hep%clang'
  actsvg:
    require:
    - '@0.4.56'
    - ~examples  # +examples is fixed in actsvg@0.4.57
  acts-dd4hep:
    require:
    - '@1.0.1'
  afterburner:
    require:
    - '@0.1.3'
    - +root +zlib
  algorithms:
    require:
    - '@1.2.0'
  binutils:
    require:
    - ~gold
  blas:
    require:
    - openblas
  boost:
    require:
    - '@1.86.0:'
    - +atomic +chrono +context +date_time +exception +fiber +filesystem +graph
    - +iostreams +locale +log +math +program_options +python +random +regex
    - +serialization +system +test +thread +timer +wave 
    - cxxstd=20
  cairo:
    require:
    - '@1.18.2:'
    - +fc+ft+X+pdf+gobject
  catch2:
    require:
    - '@3.4.0:'
    - -ipo
  celeritas:
    require:
    - '@0.6.3:'
    - +covfie +geant4 +hepmc3  +vecgeom
    - one_of: [~cuda +root, +cuda +ipo ~root]
  cernlib:
    require:
    - '@2022.11.08.0-free'
    - -shared
  clhep:
    require:
    - '@2.4.7.1'
    - cxxstd=20
  cli11:
    require:
    - '@2.4.2:'
  cmake:
    require:
    - '@3.30:'
  cnpy:
    require:
    - '@master'
  covfie:
    require:
    - '@0.14:'
  cppcoro:
    require:
    - '@10bbcdbf2be3ad3aa56febcf4c7662d771460a99'
  dawn:
    require:
    - '@3_91a'
  dawncut:
    require:
    - '@1_54a'
  dbus:
    require:
    # Until 1.15.12, https://gitlab.freedesktop.org/dbus/dbus/-/commit/b104667bd7ec55dda057ff4ffdde848336f253f4,
    # the meson build assumes that the user name exists as a group name as well. Require 1.14.10 (only autotools).
    - '@1.16.2:'
  dd4hep:
    require:
    - '@1.33'
    - +ddg4 +ddcad +edm4hep +hepmc3 +xercesc
    - any_of: [+ddeve +utilityapps, -ddeve -utilityapps] # FIXME ^root +x +opengl when +utilityapps
  doxygen:
    require:
    - +graphviz
  dpmjet:
    require:
    - '@19.3.5'
  east:
    require:
    - '@656aa3192b097a631ddd1e0380e80c26fd6644a7'
  edm4eic:
    require:
    - '@8.7.0' # EDM4EIC_VERSION
    - cxxstd=20
  edm4hep:
    require:
    - '@0.99.4'
    - cxxstd=20
  egl:
    buildable: False
    externals:
    - spec: egl@1.5.0
      prefix: /usr
  eic-smear:
    require:
    - '@1.1.16'
  eicrecon:
    require:
    - '@1.33.1' # EICRECON_VERSION
  eigen:
    require:
    - '@3.4.0'
  emacs:
    require:
    - '@28.2:'
  epic:
    require:
    - 'artifacts=epic_craterlake'
  estarlight:
    require:
    - '@1.2.0'
    -  ~dpmjet +hepmc3 ~pythia6 ~pythia8
  fastjet:
    require:
    - '@3.5.0'
    - plugins=cxx
  fjcontrib:
    require:
    - '@1.051'
  flame:
    require:
    - libflame
  fmt:
    require:
    - '@11.2.0:11'
    - +shared cxxstd=20
  freetype:
    require:
    - build_system=autotools
  gaudi:
    require:
    - '@39.4'
    - +aida
  gdb:
    require:
    - '@15.2:'
    - +debuginfod
  g4ndl:
    buildable: False
    externals:
    - spec: g4ndl@4.7.1
      prefix: /opt/software/externals/g4ndl
  geant4:
    require:
    - '@11.3.2.east'
    - cxxstd=20 -vecgeom +threads -timemory -vtk
    - any_of: [+opengl +qt +x11, -opengl -qt -x11]
  gettext: 
    require:
    - +libxml2
  gfal2:
    require:
    - +file +http +xrootd
  ghostscript:
    require:
    - ~gtk
  gl:
    require:
    - glx
  gloo:
    require:
    - '@2023-12-03'
  graphviz:
    require:
    - '@12.1.0:'
    - +expat ~ghostscript +pangocairo
  harfbuzz:
    require:
    # harfbuzz fails to find cairo.h in the gir parts of cmake builds when cairo is meson-built
    - spec: build_system=meson
      when: +gobject ^cairo build_system=meson
  hdf5:
    require:
    - ~cxx ~fortran +hl +ipo ~java ~map +mpi +shared ~subfiling ~szip ~threadsafe +tools
  hepmc3:
    require:
    - '@3.3.0'
    - +python +rootio
  hepmcmerger:
    require:
    - '@2.1.0'
  heppdt:
    require:
    - '@2.06.01'
  highfive:
    require:
    - +mpi
  imagemagick:
    require:
    - +ghostscript
    - '@7.1.1-11:'
  irt:
    require:
    - '@1.0.9'
  irt2:
    require:
    - '@2.1.0'
  iwyu:
    require:
    - '@0.23'
  jana2:
    require:
    - '@2.4.3'
    - -ipo +podio +root +zmq
  juggler:
    require:
    - '@15.0.5' # JUGGLER_VERSION
    - cxxstd=20
  julia:
    require:
    - '@1.11'
  k4actstracking:
    require:
    - '@0.1'
  k4fwcore:
    require:
    - '@1.3'
  lapack:
    require:
    - openblas
  lcov:
    require:
    - '@1.16:'
  libglx:
    require:
    - opengl
  lhapdf:
    require:
    - '@6.5.5'
    - +python
  llvm:
    require:
    - any_of: [~gold, '@:']
    # FIXME any ipo requirement breaks llvm external reuse
    #- any_of: [~ipo, '@:']
  madx:
    require:
    - '@5.08.01:'
  mesa:
    require:
    - '@23.3.6'
    - +glx +llvm +opengl +opengles +osmesa
  mosquitto:
    require:
    - '@2.0.18:'
  nlohmann-json:
    require:
    - '@3.11.2:'
  nano:
    require:
    - '@7.2:'
  nopayloadclient:
    require:
    - '@0.0.3'
  npsim:
    require:
    - '@1.4.6'
    - +http
    - any_of: [+geocad, -geocad]
  ollama:
    require:
    - '@0.13.1:'
  onnx:
    require:
    - '@1.17.0'
  openblas:
    require:
    - ~fortran
    - spec: build_system=makefile
      when: +ilp64
      # https://github.com/spack/spack-packages/pull/2890
  opencascade:
    require:
    - '@7.8.1:'
    - +application_framework -vtk
  opengl:
    buildable: False
    externals:
    - spec: opengl@4.6
      prefix: /usr
  openldap:
    require:
    - ~sasl
  openloops:
    require:
    - '@2.1.4:'
    - processes=ppvj,ppjj
  osg-ca-certs:
    require:
    - '@1.119.igtf.1.128'
  pcre:
    require:
    - build_system=cmake
    - cflags=-fPIC cxxflags=-fPIC 
  pcre2:
    require:
    # FIXME julia requires libpcre2-8.so, but shared lib is only built by autotools
    - build_system=autotools
  phonebook-cli:
    require:
    - '@1.0.0'
  podio:
    require:
    - '@1.6'
    - cxxstd=20
    - +rntuple
    package_attributes:
      run_tests: true
  prmon:
    require:
    - +plot
  protobuf:
    require:
    - '@3.28.2'
  pyrobird:
    require:
    - '@0.1.23:'
    - +xrootd
    - spec: ~batch
      when: '@:0.2.6'
      message: "Through at least 0.2.6, +batch requires py-pyppeteer which requires py-urllib3@1"
  pythia8:
    require:
    - '@8.315'
    - +fastjet +root
  python:
    require:
    - '@3.13'
  py-awkward:
    require:
    - '@2.6.6:'
  py-beautifulsoup4:
    require:
    - '@4.12:'
  py-bokeh:
    require:
    - '@3.5.2:'
  py-boost-histogram:
    require:
    - '@1.5:'
  py-dask:
    require:
    - '@2024.12.1'  # pinned within py-hist's supported range 2023:2024
  py-dask-histogram:
    require:
    - '@2025.2.0:'
  py-epic-capybara:
    require:
    - '@git.ef2a8790312b9b697655b28a07b353e601bfa3b8'
  py-flatbuffers:
    require:
    - '@25.9.23:'
  py-hatchling:
    require:
    - '@1.27:'
  py-hepunits:
    require:
    - '@2.3.2:'
  py-hist:
    require:
    - '@2.8.1:'
    - +dask +plot
  py-histoprint:
    require:
    - '@2.4.0:'
  py-htgettoken:
    require:
    - '@1.16-33-g3788bb4'
  py-ipython:
    require:
    - '@8.28:'
  py-jinja2:
    require:
    - '@3.1.4:'
  py-jinja2-cli:
    require:
    - '@0.8.2:'
  py-jsonschema:
    require:
    - +format-nongpl # non-default required for jupyter stack
  py-jupyterlab:
    require:
    - '@4.3.5:'
  py-keras:
    require:
    - '@3.12:'
    - backend=tensorflow
  py-llvmlite:
    require:
    - '@0.44.0'
  py-lmfit:
    require:
    - '@1.0.2:'
  py-mplhep:
    require:
    - '@0.4.0:'
  py-nbformat:
    require:
    - '@5.8:' # avoid py-jupyter-server and snakemake divergence
  py-numba:
    require:
    - '@0.61.0:'
  py-numpy:
    require:
    - '@2.0.2:'
  py-onnx:
    require:
    - '@1.17.0'
  py-onnxruntime:
    require:
    - '@1.22.2:'
  py-pandas:
    require:
    - '@2.2.3:'
  py-particle:
    require:
    - '@0.24.0:'
  py-pip:
    require:
    - '@23.1.2:'
  py-pre-commit:
    require:
    - '@3.6.0:'
  py-protobuf:
    require:
    - '@5.28.2'
  py-pygithub:
    require:
    - '@2.1.1:'
  py-pycairo:
    require:
    - '@1.24.0:'
  py-pyyaml:
    require:
    - '@6.0.2:'
  py-requests:
    require:
    - '@2.32.5:'
  py-rich:
    require:
    - '@13:'
  py-rucio-clients:
    require:
    - '@37.3.0:'
  py-scipy:
    require:
    - '@1.14.1:'
  py-scikit-build-core:
    require:
    - +pyproject
  py-seaborn:
    require:
    - '@0.13.2:'
  py-tensorflow:
    require:
    - '%clang'
    - '@2.20'
  py-toml:
    require:
    - '@0.10.2:'
  py-torch:
    require:
    - '@2.5.1'
    - -mkldnn
  py-vector:
    require:
    - '@1.5.1:'
  py-wurlitzer:
    require:
    - '@3.0.2:'
  py-yapf:
    require:
    - '@0.30.0:'
  qmake:
    require:
    - qt-base
  qt:
    require:
    - '@5.15.12:'
    - +opengl
  qt-base:
    require:
    - '@6.7.2:'
    - +opengl
  rivet:
    require:
    - '@4.1.0:'
    - hepmc=3 plugin-match=HERA,LEP,MC
  root:
    require:
    - '@6.38.00'
    - cxxstd=20 +fftw +fortran +gdml +http -ipo +mlp +python +root7 +tmva +tmva-sofie +vc +x +xrootd +ssl
    - any_of: [+opengl +webgui, -opengl -webgui]
  sherpa:
    require:
    - '@3.0.1'
    - cxxstd=20 +analysis ~blackhat ~cms +gzip +hepmc3 +hepmc3root ~internal_pdfs +ipo +lhapdf +lhole +mpi +openloops +pythia +python ~recola +rivet +root ~ufo
  simsipm:
    require:
    - '@2.1.0'
  snakemake:
    require:
    - '@8.5.2'
  py-snakemake-storage-plugin-fs:
    require:
    - '@0.2.0:'
  py-snakemake-storage-plugin-http:
    require:
    - '@0.2.3:'
  py-snakemake-storage-plugin-s3:
    require:
    - '@0.2.10:'
  rust:
    require:
    - +dev
  spdlog:
    require:
    - '@1.15.2:'
  stow:
    require:
    - '@2.3.1:'
  strace:
    require:
    - -mpers
  tbb:
    require:
    - 'intel-tbb'
  tensorflow-lite:
    require:
    - '@2.8.0'
    - -xnnpack
  valgrind:
    require:
    - '@3.20.0:'
  vecgeom:
    require:
    - '@1.2.11'
  xerces-c:
    require:
    - cxxstd=20
  xrootd:
    require:
    - '@5.7.0:'
    - cxxstd=20 -davix +python +scitokens-cpp
  yoda:
    require:
    - '@2.1.0:'
  zlib-api:
    require:
    - zlib-ng
  zlib-ng:
    require:
    - '@2.1.4:'
